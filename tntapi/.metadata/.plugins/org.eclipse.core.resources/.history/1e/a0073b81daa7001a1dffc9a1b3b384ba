package com.tntapi.service;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.tntapi.domain.Team;
import com.tntapi.domain.User;
import com.tntapi.exception.TeamNotFoundException;
import com.tntapi.exception.UserNotFoundException;
import com.tntapi.repository.TeamRepository;
import com.tntapi.repository.UserRepository;

@Service
public class UserService {
	
	@Autowired
	private UserRepository userRepository;
	@Autowired
	private TeamRepository teamRepository;
	
	public User addUser(String teamCode,User user) {
		
		try {
			//find team
			Team team=teamRepository.findByTeamCode(teamCode);
			//setting  team to user
			user.setTeam(team);
			// setting team code to user
			user.setTeamCode(teamCode);
			//generating userCode with teamCode and userSequence
			Integer userSequence=team.getUserSequence();
			userSequence++;
			team.setUserSequence(userSequence);
			user.setUserCode(user.getTeamCode()+"-"+userSequence);
			return userRepository.save(user);
		} catch (Exception e) {
			throw new TeamNotFoundException("Team Does not exist");
		}
	}
	
	public User findUserByUCode(String teamCode,String userCode) {
		
		//finding team
		Team team=teamRepository.findByTeamCode(teamCode);
		//if not found
		if (team==null) {
			throw new TeamNotFoundException("Team with team code '"+teamCode+"' does not exist");
		}
		//finding user
		User user=userRepository.findUserByUserCode(userCode);
		//if user not found
		if (user==null) {
			throw new UserNotFoundException("User not found");
		}
		if (!user.getTeamCode().equals(teamCode)) {
			throw new UserNotFoundException("user code '"+userCode+"' does not match with team code '"+teamCode+"'");
		}
		return user;
	}
	
	public List<User> findUserList(String teamCode){
		//find team
		Team team = teamRepository.findByTeamCode(teamCode);
		//team not found
		if (team==null) {
			throw new TeamNotFoundException("Team with team code '"+teamCode+"' does not exist");
		}
		return userRepository.findByTeamCode(teamCode);
		
	}
}
