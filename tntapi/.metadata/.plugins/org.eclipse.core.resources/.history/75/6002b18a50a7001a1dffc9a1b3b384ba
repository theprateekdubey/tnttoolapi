package com.tntapi.service;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.tntapi.domain.Team;
import com.tntapi.domain.User;
import com.tntapi.exception.TeamNotFoundException;
import com.tntapi.repository.TeamRepository;
import com.tntapi.repository.UserRepository;

@Service
public class UserService {
	
	@Autowired
	private UserRepository userRepository;
	@Autowired
	private TeamRepository teamRepository;
	
	public User addUser(String teamCode,User user) {
		
		try {
			//find team
			Team team=teamRepository.findByTeamCode(teamCode);
			//setting  team to user
			user.setTeam(team);
			// setting team code to user
			user.setTeamCode(teamCode);
			//generating userCode with teamCode and userSequence
			Integer userSequence=team.getUserSequence();
			userSequence++;
			team.setUserSequence(userSequence);
			user.setUserCode(user.getTeamCode()+"-"+userSequence);
			return userRepository.save(user);
		} catch (Exception e) {
			throw new TeamNotFoundException("Team Does not exist");
		}
	}
	
	public User findUserByUCode(String userCode,String teamCode) {
		//finding team
		Team team=teamRepository.findByTeamCode(teamCode);
		//if not found
		if (team==null) {
			throw new TeamNotFoundException("Team with team code '"+teamCode+"' does not exist");
		}
		//finding user
		User user=userRepository.findUserByUserCode(userCode);
	}

}
